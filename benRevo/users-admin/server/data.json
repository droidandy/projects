{
  "scripts": {
    "filter": "function(ctx, callback) {\n  // Get the department from the current user's metadata.\n  var role = ctx.request.user.app_metadata && ctx.request.user.app_metadata.brokerageRole;\n  var brokerageId = ctx.request.user.app_metadata && ctx.request.user.app_metadata.brokerageId;\n  // If the user does not belong to a department we'll throw an error.\n  if (!role || !role.length) {\n    return callback(new Error('The current user is not part of any brokerage.'));\n  }\n\n  // The Executive department can see all users.\n\tif (role === 'superadmin') {\n      return callback();\n} else if (role === 'admin') {\n    // More details on syntax of query available here: https://auth0.com/docs/api/management/v2/user-search\n    return callback(null, 'app_metadata.brokerageId:\"' + brokerageId + '\"');\n  }\n\n  return callback(new Error('No role specified'));\n}",
    "create": "function(ctx, callback) {\n    // Get the department from the current user's metadata.\n    var role = ctx.request.user.app_metadata && ctx.request.user.app_metadata.brokerageRole;\n    var brokerageName = ctx.request.user.app_metadata && ctx.request.user.app_metadata.brokerage;\n    var brokerageId = ctx.request.user.app_metadata && ctx.request.user.app_metadata.brokerageId;\n    var carrierAcl = ctx.request.user.app_metadata && ctx.request.user.app_metadata.carrierAcl;\n\n    if (!role || !role.length) {\n        return callback(new Error('The current user is not part of any role.'));\n    }\n\n    // Check to see if an account being created will belong to the `admin` department\n    if(!role == 'admin' && ctx.payload.memberships[0] == 'admin') {\n        // If it will, but the account attempting to create it is not an Executive, then the call will fail\n        return callback(new Error('You can only create users, not admins.'));\n    } else {\n        // Otherwise create the account\n        return callback(null, {\n            email: ctx.payload.email,\n            password: ctx.payload.password,\n            connection: ctx.payload.connection,\n            app_metadata: {\n                brokerageRole: 'user',\n                brokerage: brokerageName,\n                brokerageId: brokerageId,\n                carrierAcl: carrierAcl\n            }\n        });\n    }\n\n    return callback();\n}",
    "memberships": "function(ctx, callback) {\n  return callback(null, {\n    memberships: [ \"user\" ]\n  });\n}",
    "settings": "function(ctx, callback) {\n  ctx.log('Hello there');\n  var role = ctx.request.user.app_metadata && ctx.request.user.app_metadata.brokerageRole;\n  var brokerage = ctx.request.user.app_metadata && ctx.request.user.app_metadata.brokerage;\n\n  if(role === \"admin\"){\n    return callback(null, {\n      // Only these connections should be visible in the connections picker.\n      // If only one connection is available, the connections picker will not be shown in the UI.\n      connections: ['BenRevoAdminsDb', 'AnthemUsers'],\n    });\n  }\n\n  return callback();\n}"
  }
}