NAME=SwiftyJSON
GIT_URI=https://github.com/SwiftyJSON/SwiftyJSON.git
PATCH_PREFIX="0002"

echo ------ $NAME -----

fetch() {
  rm -rf ./$NAME
  git clone $GIT_URI --branch master --depth 1

  echo write VERSION.hash file ...
  cd $NAME && git rev-parse HEAD >VERSION.hash && cd ..
}

clean() {
  echo cleanup ...
  rm -rf ./$NAME/.git
  rm -rf ./$NAME/.gitignore
  rm -rf ./$NAME/.github
  rm -rf ./$NAME/Example
  rm -rf ./$NAME/Tests
  echo ----------------------------------
}

# Создаётся патч с текущими незакоммиченными изменениями в папке либы
mkpatch() {
  PATH_FILE="$NAME.patches/$PATCH_PREFIX-$NAME.patch"
  git diff HEAD $NAME >"$PATH_FILE"
  echo "Make patch done: $PATH_FILE"
}

patch() {
  echo patch ...
  git apply ./$NAME.patches/0001-$NAME.patch
  echo ----------------------------------
}

case "$1" in
fetch) fetch ;;
clean) clean ;;
patch) patch ;;
mkpatch) mkpatch ;;
*)
  fetch
  clean
  patch
  ;;
esac
