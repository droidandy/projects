/*!
 * widgets
 * @version: 9.0.017.00
 * @license: Genesys Telecom Labs
 */
widgetsJsonpFunction([17],{"./node_modules/cometd/cometd.js":function(e,t,n){!function(t,n){e.exports=function(){function e(){var e={};self.onmessage=function(t){var n=t.data,r=e[n.id];switch(n.type){case"setTimeout":e[n.id]=self.setTimeout(function(){delete e[n.id],self.postMessage({id:n.id})},n.delay);break;case"clearTimeout":delete e[n.id],r&&self.clearTimeout(r);break;default:throw"Unknown command "+n.type}}}var t=function(){var e=0,t={};this.register=function(n){var r=++e;return t[r]=n,r},this.unregister=function(e){var n=t[e];return delete t[e],n},this.setTimeout=function(e,t){return window.setTimeout(e,t)},this.clearTimeout=function(e){window.clearTimeout(e)}},n={isString:function(e){return void 0!==e&&null!==e&&("string"==typeof e||e instanceof String)},isArray:function(e){return void 0!==e&&null!==e&&e instanceof Array},inArray:function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1}},r=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,r,i){for(var s=[],a=0;a<e.length;++a){var o=e[a];!0===t[o].accept(n,r,i)&&s.push(o)}return s},this.negotiateTransport=function(n,r,i,s){for(var a=0;a<e.length;++a)for(var o=e[a],c=0;c<n.length;++c)if(o===n[c]){var u=t[o];if(!0===u.accept(r,i,s))return u}return null},this.add=function(n,r,i){for(var s=!1,a=0;a<e.length;++a)if(e[a]===n){s=!0;break}return s||("number"!=typeof i?e.push(n):e.splice(i,0,n),t[n]=r),!s},this.find=function(n){for(var r=0;r<e.length;++r)if(e[r]===n)return t[n];return null},this.remove=function(n){for(var r=0;r<e.length;++r)if(e[r]===n){e.splice(r,1);var i=t[n];return delete t[n],i}return null},this.clear=function(){e=[],t={}},this.reset=function(n){for(var r=0;r<e.length;++r)t[e[r]].reset(n)}},i=function(){var e,t,r;this.registered=function(n,r){e=n,t=r},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return t.setTimeout(e,n)},this.clearTimeout=function(e){t.clearTimeout(e)},this.convertToMessages=function(e){if(n.isString(e))try{return JSON.parse(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(n.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return e},this.getURL=function(){return r},this.setURL=function(e){r=e},this.send=function(e,t){throw"Abstract"},this.reset=function(t){this._debug("Transport",e,"reset",t?"initial":"retry")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}};i.derive=function(e){function t(){}return t.prototype=e,new t};var s=function(){function e(e){for(;p.length>0;){var t=p[0],n=t[0],r=t[1];if(n.url!==e.url||n.sync!==e.sync)break;p.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",r.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,r=n;!0===t.metaConnect&&(r+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",r,"ms for the response, maxNetworkDelay",n);var i=this;t.timeout=this.setTimeout(function(){t.expired=!0;var n="Request "+t.id+" of transport "+i.getType()+" exceeded "+r+" ms max network delay",s={reason:n},a=t.xhr;s.httpCode=i.xhrStatus(a),i.abortXHR(a),i._debug(n),i.complete(t,!1,t.metaConnect),e.onFailure(a,e.messages,s)},r)}}function r(e){var n=++d,r={id:n,metaConnect:!1,envelope:e};f.length<this.getConfiguration().maxConnections-1?(f.push(r),t.call(this,e,r)):(this._debug("Transport",this.getType(),"queueing request",n,"envelope",e),p.push([e,r]))}function s(e){var t=e.id;if(this._debug("Transport",this.getType(),"/meta/connect complete, request",t),null!==l&&l.id!==t)throw"/meta/connect request mismatch, completing request "+t;l=null}function a(t,i){var s=n.inArray(t,f);if(s>=0&&f.splice(s,1),p.length>0){var a=p.shift(),o=a[0],c=a[1];if(this._debug("Transport dequeued request",c.id),i)this.getConfiguration().autoBatch&&e.call(this,o),r.call(this,o),this._debug("Transport completed request",t.id,o);else{var u=this;this.setTimeout(function(){u.complete(c,!1,c.metaConnect);var e={reason:"Previous request failed"},t=c.xhr;e.httpCode=u.xhrStatus(t),o.onFailure(t,o.messages,e)},0)}}}function o(e){if(null!==l)throw"Concurrent /meta/connect requests not allowed, request id="+l.id+" not yet completed";var n=++d;this._debug("Transport",this.getType(),"/meta/connect send, request",n,"envelope",e);var r={id:n,metaConnect:!0,envelope:e};t.call(this,e,r),l=r}var c=new i,u=i.derive(c),d=0,l=null,f=[],p=[];return u.complete=function(e,t,n){n?s.call(this,e):a.call(this,e,t)},u.transportSend=function(e,t){throw"Abstract"},u.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},u.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},u.send=function(e,t){t?o.call(this,e):r.call(this,e)},u.abort=function(){c.abort();for(var e=0;e<f.length;++e){var t=f[e];t&&(this._debug("Aborting request",t),this.abortXHR(t.xhr)||this.transportFailure(t.envelope,t,{reason:"abort"}))}var n=l;n&&(this._debug("Aborting /meta/connect request",n),this.abortXHR(n.xhr)||this.transportFailure(n.envelope,n,{reason:"abort"})),this.reset(!0)},u.reset=function(e){c.reset(e),l=null,f=[],p=[]},u.abortXHR=function(e){if(e)try{var t=e.readyState;return e.abort(),t!==window.XMLHttpRequest.UNSENT}catch(e){this._debug(e)}return!1},u.xhrStatus=function(e){if(e)try{return e.status}catch(e){this._debug(e)}return-1},u},a=function(){var e=new s,t=i.derive(e),n=!0;return t.accept=function(e,t,r){return n||!t},t.newXMLHttpRequest=function(){return new window.XMLHttpRequest},t.xhrSend=function(e){var n=t.newXMLHttpRequest();n.context=t.context,n.withCredentials=!0,n.open("POST",e.url,!0!==e.sync);var r=e.headers;if(r)for(var i in r)r.hasOwnProperty(i)&&n.setRequestHeader(i,r[i]);return n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.onload=function(){200===n.status?e.onSuccess(n.responseText):e.onError(n.statusText)},n.onerror=function(){e.onError(n.statusText)},n.send(e.body),n},t.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var r=this;try{var i=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(e.messages),onSuccess:function(i){r._debug("Transport",r.getType(),"received response",i);var s=!1;try{var a=r.convertToMessages(i);0===a.length?(n=!1,r.transportFailure(e,t,{httpCode:204})):(s=!0,r.transportSuccess(e,t,a))}catch(i){if(r._debug(i),!s){n=!1;var o={exception:i};o.httpCode=r.xhrStatus(t.xhr),r.transportFailure(e,t,o)}}},onError:function(s,a){r._debug("Transport",r.getType(),"received error",s,a),n=!1;var o={reason:s,exception:a};o.httpCode=r.xhrStatus(t.xhr),i?r.setTimeout(function(){r.transportFailure(e,t,o)},0):r.transportFailure(e,t,o)}}),i=!1}catch(i){n=!1,this.setTimeout(function(){r.transportFailure(e,t,{exception:i})},0)}},t.reset=function(t){e.reset(t),n=!0},t},o=function(){function e(e,t,n){var r=this;return function(){r.transportFailure(e,t,"error",n)}}var t=new s,n=i.derive(t),r=0;return n.accept=function(e,t,n){return!0},n.jsonpSend=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),i="_cometd_jsonp_"+r++;window[i]=function(r){t.removeChild(n),delete window[i],e.onSuccess(r)};var s=e.url;s+=s.indexOf("?")<0?"?":"&",s+="jsonp="+i,s+="&message="+encodeURIComponent(e.body),n.src=s,n.async=!0!==e.sync,n.type="application/javascript",n.onerror=function(t){e.onError("jsonp "+t.type)},t.appendChild(n)},n.transportSend=function(t,n){for(var r=this,i=0,s=t.messages.length,a=[];s>0;){var o=JSON.stringify(t.messages.slice(i,i+s)),c=t.url.length+encodeURI(o).length,u=this.getConfiguration().maxURILength;if(c>u){if(1===s){var d="Bayeux message too big ("+c+" bytes, max is "+u+") for transport "+this.getType();return void this.setTimeout(e.call(this,t,n,d),0)}--s}else a.push(s),i+=s,s=t.messages.length-i}var l=t;if(a.length>1){var f=0,p=a[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",a.join(" + ")),l=this._mixin(!1,{},t),l.messages=t.messages.slice(f,p),l.onSuccess=t.onSuccess,l.onFailure=t.onFailure;for(var g=1;g<a.length;++g){var h=this._mixin(!1,{},t);f=p,p+=a[g],h.messages=t.messages.slice(f,p),h.onSuccess=t.onSuccess,h.onFailure=t.onFailure,this.send(h,n.metaConnect)}}this._debug("Transport",this.getType(),"sending request",n.id,"envelope",l);try{var m=!0;this.jsonpSend({transport:this,url:l.url,sync:l.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(l.messages),onSuccess:function(e){var t=!1;try{var i=r.convertToMessages(e);0===i.length?r.transportFailure(l,n,{httpCode:204}):(t=!0,r.transportSuccess(l,n,i))}catch(e){r._debug(e),t||r.transportFailure(l,n,{exception:e})}},onError:function(e,t){var i={reason:e,exception:t};m?r.setTimeout(function(){r.transportFailure(l,n,i)},0):r.transportFailure(l,n,i)}}),m=!1}catch(e){this.setTimeout(function(){r.transportFailure(l,n,{exception:e})},0)}},n},c=function(){function e(e,t){e&&(this.webSocketClose(e,t.code,t.reason),this.onClose(e,t))}function t(e){return e===h||e===g}function r(e,t,n){for(var r=[],i=0;i<t.messages.length;++i){var s=t.messages[i];s.id&&r.push(s.id)}e.envelopes[r.join(",")]=[t,n],this._debug("Transport",this.getType(),"stored envelope, envelopes",e.envelopes)}function s(n){if(!h){var r=c.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",r);try{var i=c.getConfiguration().protocol;n.webSocket=i?new window.WebSocket(r,i):new window.WebSocket(r),h=n}catch(e){throw l=!1,this._debug("Exception while creating WebSocket object",e),e}p=!1!==c.getConfiguration().stickyReconnect;var s=this,a=c.getConfiguration().connectTimeout;a>0&&(n.connectTimer=this.setTimeout(function(){c._debug("Transport",s.getType(),"timed out while connecting to URL",r,":",a,"ms"),e.call(s,n,{code:1e3,reason:"Connect Timeout"})},a));var o=function(){c._debug("WebSocket onopen",n),n.connectTimer&&s.clearTimeout(n.connectTimer),t(n)?(h=null,g=n,f=!0,s.onOpen(n)):(c._warn("Closing extra WebSocket connection",this,"active connection",g),e.call(s,n,{code:1e3,reason:"Extra Connection"}))},u=function(e){e=e||{code:1e3},c._debug("WebSocket onclose",n,e,"connecting",h,"current",g),n.connectTimer&&s.clearTimeout(n.connectTimer),s.onClose(n,e)},d=function(e){c._debug("WebSocket onmessage",e,n),s.onMessage(n,e)};n.webSocket.onopen=o,n.webSocket.onclose=u,n.webSocket.onerror=function(){u({code:1e3,reason:"Error"})},n.webSocket.onmessage=d,this._debug("Transport",this.getType(),"configured callbacks on",n)}}function a(t,n,r){var i=JSON.stringify(n.messages);t.webSocket.send(i),this._debug("Transport",this.getType(),"sent",n,"/meta/connect =",r);var s=this.getConfiguration().maxNetworkDelay,a=s;r&&(a+=this.getAdvice().timeout,m=!0);for(var o=this,u=[],d=0;d<n.messages.length;++d)!function(){var r=n.messages[d];r.id&&(u.push(r.id),t.timeouts[r.id]=o.setTimeout(function(){c._debug("Transport",o.getType(),"timing out message",r.id,"after",a,"on",t),e.call(o,t,{code:1e3,reason:"Message Timeout"})},a))}();this._debug("Transport",this.getType(),"waiting at most",a,"ms for messages",u,"maxNetworkDelay",s,", timeouts:",t.timeouts)}function o(t,n,i){try{null===t?(t=h||{envelopes:{},timeouts:{}},r.call(this,t,n,i),s.call(this,t)):(r.call(this,t,n,i),a.call(this,t,n,i))}catch(n){var o=this;this.setTimeout(function(){e.call(o,t,{code:1e3,reason:"Exception",exception:n})},0)}}var c,u=new i,d=i.derive(u),l=!0,f=!1,p=!0,g=null,h=null,m=!1,v=null;return d.reset=function(e){u.reset(e),l=!0,e&&(f=!1),p=!0,g=null,h=null,m=!1},d._notifySuccess=function(e,t){e.call(this,t)},d._notifyFailure=function(e,t,n,r){e.call(this,t,n,r)},d.onOpen=function(e){var t=e.envelopes;this._debug("Transport",this.getType(),"opened",e,"pending messages",t);for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],i=r[0],s=r[1];v=i.onSuccess,a.call(this,e,i,s)}},d.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var r=!1,i=this.convertToMessages(t.data),s=[],a=0;a<i.length;++a){var o=i[a];if((/^\/meta\//.test(o.channel)||void 0===o.data)&&o.id){s.push(o.id);var c=e.timeouts[o.id];c&&(this.clearTimeout(c),delete e.timeouts[o.id],this._debug("Transport",this.getType(),"removed timeout for message",o.id,", timeouts",e.timeouts))}"/meta/connect"===o.channel&&(m=!1),"/meta/disconnect"!==o.channel||m||(r=!0)}for(var u=!1,d=e.envelopes,l=0;l<s.length;++l){var f=s[l];for(var p in d)if(d.hasOwnProperty(p)){var g=p.split(","),h=n.inArray(f,g);if(h>=0){u=!0,g.splice(h,1);var y=d[p][0],b=d[p][1];delete d[p],g.length>0&&(d[g.join(",")]=[y,b]);break}}}u&&this._debug("Transport",this.getType(),"removed envelope, envelopes",d),this._notifySuccess(v,i),r&&this.webSocketClose(e,1e3,"Disconnect")},d.onClose=function(e,n){this._debug("Transport",this.getType(),"closed",e,n),t(e)&&(l=p&&f,h=null,g=null);var r=e.timeouts;e.timeouts={};for(var i in r)r.hasOwnProperty(i)&&this.clearTimeout(r[i]);var s=e.envelopes;e.envelopes={};for(var a in s)if(s.hasOwnProperty(a)){var o=s[a][0],c=s[a][1];c&&(m=!1);var u={websocketCode:n.code,reason:n.reason};n.exception&&(u.exception=n.exception),this._notifyFailure(o.onFailure,e,o.messages,u)}},d.registered=function(e,t){u.registered(e,t),c=t},d.accept=function(e,t,n){return this._debug("Transport",this.getType(),"accept, supported:",l),l&&!!window.WebSocket&&!1!==c.websocketEnabled},d.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"/meta/connect =",t),o.call(this,g,e,t)},d.webSocketClose=function(e,t,n){try{e.webSocket&&e.webSocket.close(t,n)}catch(e){this._debug(e)}},d.abort=function(){u.abort(),e.call(this,g,{code:1e3,reason:"Abort"}),this.reset(!0)},d},u=function(i){function s(e,t){try{return e[t]}catch(e){return}}function u(e){return n.isString(e)}function d(e){return void 0!==e&&null!==e&&"function"==typeof e}function l(e,t){for(var n="";--t>0&&!(e>=Math.pow(10,t));)n+="0";return n+=e}function f(e,t){if(window.console){var n=window.console[e];if(d(n)){var r=new Date;[].splice.call(t,0,0,l(r.getHours(),2)+":"+l(r.getMinutes(),2)+":"+l(r.getSeconds(),2)+"."+l(r.getMilliseconds(),3)),n.apply(window.console,t)}}}function p(e){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(e)}function g(t){be._debug("Configuring cometd object with",t),u(t)&&(t={url:t}),t||(t={}),Be=be._mixin(!1,Be,t);var n=be.getURL();if(!n)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var r=p(n),i=r[2],s=r[8],a=r[9];if(we=be._isCrossDomain(i),Be.appendMessageTypeToURL)if(void 0!==a&&a.length>0)be._info("Appending message type to URI "+s+a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Be.appendMessageTypeToURL=!1;else{var o=s.split("/"),c=o.length-1;s.match(/\/$/)&&(c-=1),o[c].indexOf(".")>=0&&(be._info("Appending message type to URI "+s+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Be.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&Be.useWorkerScheduler){var d=e.toString();d=d.substring(d.indexOf("{")+1,d.lastIndexOf("}"));var l=new window.Blob([d],{type:"application/json"}),f=window.URL.createObjectURL(l),g=new window.Worker(f);ye.setTimeout=function(e,t){var n=ye.register(e);return g.postMessage({id:n,type:"setTimeout",delay:t}),n},ye.clearTimeout=function(e){ye.unregister(e),g.postMessage({id:e,type:"clearTimeout"})},g.onmessage=function(e){var t=e.data.id,n=ye.unregister(t);n&&n()}}}function h(e){if(e){var t=Re[e.channel];t&&t[e.id]&&(delete t[e.id],be._debug("Removed",e.listener?"listener":"subscription",e))}}function m(e){e&&!e.listener&&h(e)}function v(){for(var e in Re)if(Re.hasOwnProperty(e)){var t=Re[e];if(t)for(var n in t)t.hasOwnProperty(n)&&m(t[n])}}function y(e){ke!==e&&(be._debug("Status",ke,"->",e),ke=e)}function b(){return"disconnecting"===ke||"disconnected"===ke}function T(){return""+ ++Se}function w(e,t,n,r,i){try{return t.call(e,r)}catch(e){var s=be.onExtensionException;if(d(s)){be._debug("Invoking extension exception handler",n,e);try{s.call(be,e,n,i,r)}catch(e){be._info("Exception during execution of extension exception handler",n,e)}}else be._info("Exception during execution of extension",n,e);return r}}function x(e){for(var t=0;t<Ae.length&&void 0!==e&&null!==e;++t){var n=Ae[t],r=n.extension.incoming;if(d(r)){var i=w(n.extension,r,n.name,e,!1);e=void 0===i?e:i}}return e}function k(e){for(var t=Ae.length-1;t>=0&&void 0!==e&&null!==e;--t){var n=Ae[t],r=n.extension.outgoing;if(d(r)){var i=w(n.extension,r,n.name,e,!0);e=void 0===i?e:i}}return e}function S(e,t){var n=Re[e];if(n)for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];if(i)try{i.callback.call(i.scope,t)}catch(e){var s=be.onListenerException;if(d(s)){be._debug("Invoking listener exception handler",i,e);try{s.call(be,e,i,i.listener,t)}catch(e){be._info("Exception during execution of listener exception handler",i,e)}}else be._info("Exception during execution of listener",i,t,e)}}}function C(e,t){S(e,t);for(var n=e.split("/"),r=n.length-1,i=r;i>0;--i){var s=n.slice(0,i).join("/")+"/*";i===r&&S(s,t),s+="*",S(s,t)}}function _(){null!==Pe&&be.clearTimeout(Pe),Pe=null}function I(e,t){_();var n=Le.interval+t;be._debug("Function scheduled in",n,"ms, interval =",Le.interval,"backoff =",Oe,e),Pe=be.setTimeout(e,n)}function D(e,t,n){for(var r=0;r<e.length;++r){var i=e[r],s=i.id;Ce&&(i.clientId=Ce),i=k(i),void 0!==i&&null!==i?(i.id=s,e[r]=i):(delete Me[s],e.splice(r--,1))}if(0!==e.length){t&&(Ke=e[0]);var a=be.getURL();Be.appendMessageTypeToURL&&(a.match(/\/$/)||(a+="/"),n&&(a+=n));var o={url:a,sync:!1,messages:e,onSuccess:function(e){try{He.call(be,e)}catch(e){be._info("Exception during handling of messages",e)}},onFailure:function(e,t,n){try{var r=be.getTransport();n.connectionType=r?r.getType():"unknown",We.call(be,e,t,n)}catch(e){be._info("Exception during handling of failure",e)}}};be._debug("Send",o),he.send(o,t)}}function j(e){_e>0||!0===De?Ie.push(e):D([e],!1)}function R(){Oe=0}function O(){return Oe<Be.maxBackoff&&(Oe+=Be.backoffIncrement),Oe}function P(){++_e,be._debug("Starting batch, depth",_e)}function A(){var e=Ie;Ie=[],e.length>0&&D(e,!1)}function L(){if(--_e,be._debug("Ending batch, depth",_e),_e<0)throw"Calls to startBatch() and endBatch() are not paired";0!==_e||b()||De||A()}function M(){if(!b()){var e={id:T(),channel:"/meta/connect",connectionType:he.getType()};qe||(e.advice={timeout:0}),y("connecting"),be._debug("Connect sent",e),D([e],!0,"connect"),y("connected")}}function E(e){y("connecting"),I(function(){M()},e)}function U(e){e&&(Le=be._mixin(!1,{},Be.advice,e),be._debug("New advice",Le))}function q(e){if(_(),e&&he&&he.abort(),we=!1,he=null,y("disconnected"),Ce=null,_e=0,R(),Ue=!1,qe=!1,Ne=0,Ke=null,Ie.length>0){var t=Ie;Ie=[],We.call(be,void 0,t,{reason:"Disconnected"})}}function N(e,t,n){var r=be.onTransportException;if(d(r)){be._debug("Invoking transport exception handler",e,t,n);try{r.call(be,n,e,t)}catch(e){be._info("Exception during execution of transport exception handler",e)}}}function F(e,t){d(e)&&(t=e,e=void 0),Ce=null,v(),b()&&xe.reset(!0),U({}),_e=0,De=!0,me=e,ve=t;var n=be.getURL(),r=xe.findTransportTypes("1.0",we,n),i={id:T(),version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:r,advice:{timeout:Le.timeout,interval:Le.interval}},s=be._mixin(!1,{},me,i);if(be._putCallback(s.id,t),!he&&!(he=xe.negotiateTransport(r,"1.0",we,n))){var a="Could not find initial transport among: "+xe.getTransportTypes();throw be._warn(a),a}be._debug("Initial transport is",he.getType()),y("handshaking"),be._debug("Handshake sent",s),D([s],!1,"handshake")}function K(e){y("handshaking"),De=!0,I(function(){F(me,ve)},e)}function B(e,t){try{e.call(be,t)}catch(e){var n=be.onCallbackException;if(d(n)){be._debug("Invoking callback exception handler",e);try{n.call(be,e,t)}catch(e){be._info("Exception during execution of callback exception handler",e)}}else be._info("Exception during execution of message callback",e)}}function H(e){var t=be._getCallback([e.id]);d(t)&&(delete Me[e.id],B(t,e))}function W(e){var t=Ee[e.id];if(delete Ee[e.id],t){be._debug("Handling remote call response for",e,"with context",t);var n=t.timeout;n&&be.clearTimeout(n);var r=t.callback;if(d(r))return B(r,e),!0}return!1}function J(e){be._debug("Transport failure handling",e),e.transport&&(he=e.transport),e.url&&he.setURL(e.url);var t=e.action,n=e.delay||0;switch(t){case"handshake":K(n);break;case"retry":E(n);break;case"none":q(!0);break;default:throw"Unknown action "+t}}function z(e,t){H(e),C("/meta/handshake",e),C("/meta/unsuccessful",e),b()&&(t.action="none"),be.onTransportFailure.call(be,e,t,J)}function X(e){var t=be.getURL();if(e.successful){var n=be._isCrossDomain(p(t)[2]),r=xe.negotiateTransport(e.supportedConnectionTypes,e.version,n,t);if(null===r)return e.successful=!1,void z(e,{cause:"negotiation",action:"none",transport:null});he!==r&&(be._debug("Transport",he.getType(),"->",r.getType()),he=r),Ce=e.clientId,De=!1,A(),e.reestablish=Ue,Ue=!0,H(e),C("/meta/handshake",e),Fe=e["x-messages"]||0;var i=b()?"none":Le.reconnect||"retry";switch(i){case"retry":R(),0===Fe?E(0):be._debug("Processing",Fe,"handshake-delivered messages");break;case"none":q(!0);break;default:throw"Unrecognized advice action "+i}}else z(e,{cause:"unsuccessful",action:Le.reconnect||"handshake",transport:he})}function G(e){z(e,{cause:"failure",action:"handshake",transport:null})}function V(e){return"disconnected"===ke||!(!Ke||Ke.id!==e.id)&&(Ke=null,!0)}function $(e,t){C("/meta/connect",e),C("/meta/unsuccessful",e),b()&&(t.action="none"),be.onTransportFailure.call(be,e,t,J)}function Z(e){if(V(e))if(qe=e.successful){C("/meta/connect",e);var t=b()?"none":Le.reconnect||"retry";switch(t){case"retry":R(),E(Oe);break;case"none":q(!1);break;default:throw"Unrecognized advice action "+t}}else $(e,{cause:"unsuccessful",action:Le.reconnect||"retry",transport:he});else be._debug("Mismatched /meta/connect reply",e)}function Y(e){V(e)?(qe=!1,$(e,{cause:"failure",action:"retry",transport:null})):be._debug("Mismatched /meta/connect failure",e)}function Q(e){q(!0),H(e),C("/meta/disconnect",e),C("/meta/unsuccessful",e)}function ee(e){e.successful?(q(!1),H(e),C("/meta/disconnect",e)):Q(e)}function te(e){Q(e)}function ne(e){var t=Re[e.subscription];if(t)for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r&&!r.listener&&(delete t[n],be._debug("Removed failed subscription",r))}H(e),C("/meta/subscribe",e),C("/meta/unsuccessful",e)}function re(e){e.successful?(H(e),C("/meta/subscribe",e)):ne(e)}function ie(e){ne(e)}function se(e){H(e),C("/meta/unsubscribe",e),C("/meta/unsuccessful",e)}function ae(e){e.successful?(H(e),C("/meta/unsubscribe",e)):se(e)}function oe(e){se(e)}function ce(e){W(e)||(H(e),C("/meta/publish",e),C("/meta/unsuccessful",e))}function ue(e){void 0!==e.data?W(e)||(C(e.channel,e),Fe>0&&0==--Fe&&(be._debug("Processed last handshake-delivered message"),E(0))):void 0===e.successful?be._warn("Unknown Bayeux Message",e):e.successful?(H(e),C("/meta/publish",e)):ce(e)}function de(e){ce(e)}function le(e){if(Ne=0,void 0!==(e=x(e))&&null!==e)switch(U(e.advice),e.channel){case"/meta/handshake":X(e);break;case"/meta/connect":Z(e);break;case"/meta/disconnect":ee(e);break;case"/meta/subscribe":re(e);break;case"/meta/unsubscribe":ae(e);break;default:ue(e)}}function fe(e){var t=Re[e];if(t)for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0;return!1}function pe(e,t){var n={scope:e,method:t};if(d(e))n.scope=void 0,n.method=e;else if(u(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!d(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!d(t))throw"Invalid callback "+t;return n}function ge(e,t,n,r){var i=pe(t,n);be._debug("Adding",r?"listener":"subscription","on",e,"with scope",i.scope,"and callback",i.method);var s=++je,a={id:s,channel:e,scope:i.scope,callback:i.method,listener:r},o=Re[e];return o||(o={},Re[e]=o),o[s]=a,be._debug("Added",r?"listener":"subscription",a),a}var he,me,ve,ye=new t,be=this,Te=i||"default",we=!1,xe=new r,ke="disconnected",Se=0,Ce=null,_e=0,Ie=[],De=!1,je=0,Re={},Oe=0,Pe=null,Ae=[],Le={},Me={},Ee={},Ue=!1,qe=!1,Ne=0,Fe=0,Ke=null,Be={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};this._mixin=function(e,t,n){for(var r=t||{},i=2;i<arguments.length;++i){var a=arguments[i];if(void 0!==a&&null!==a)for(var o in a)if(a.hasOwnProperty(o)){var c=s(a,o),u=s(r,o);if(c===t)continue;if(void 0===c)continue;if(e&&"object"==typeof c&&null!==c)if(c instanceof Array)r[o]=this._mixin(e,u instanceof Array?u:[],c);else{var d="object"!=typeof u||u instanceof Array?{}:u;r[o]=this._mixin(e,d,c)}else r[o]=c}}return r},this._warn=function(){f("warn",arguments)},this._info=function(){"warn"!==Be.logLevel&&f("info",arguments)},this._debug=function(){"debug"===Be.logLevel&&f("debug",arguments)},this._isCrossDomain=function(e){return!!(window.location&&window.location.host&&e)&&e!==window.location.host};var He,We;this.send=j,this._getCallback=function(e){return Me[e]},this._putCallback=function(e,t){var n=this._getCallback(e);return d(t)&&(Me[e]=t),n},this.onTransportFailure=function(e,t,n){this._debug("Transport failure",t,"for",e);var r=this.getTransportRegistry(),i=this.getURL(),s=this._isCrossDomain(p(i)[2]),a=r.findTransportTypes("1.0",s,i);if("none"===t.action){if("/meta/handshake"===e.channel&&!t.transport){var o="Could not negotiate transport, client=["+a+"], server=["+e.supportedConnectionTypes+"]";this._warn(o),N(he.getType(),null,{reason:o,connectionType:he.getType(),transport:he})}}else if(t.delay=this.getBackoffPeriod(),"/meta/handshake"===e.channel){if(!t.transport){var c=r.negotiateTransport(a,"1.0",s,i);c?(this._debug("Transport",he.getType(),"->",c.getType()),N(he.getType(),c.getType(),e.failure),t.action="handshake",t.transport=c):(this._warn("Could not negotiate transport, client=["+a+"]"),N(he.getType(),null,e.failure),t.action="none")}"none"!==t.action&&this.increaseBackoffPeriod()}else{var u=(new Date).getTime();if(0===Ne&&(Ne=u),"retry"===t.action){t.delay=this.increaseBackoffPeriod();var d=Le.maxInterval;if(d>0){var l=Le.timeout+Le.interval+d,f=u-Ne;f+Oe>l&&(t.action="handshake")}}"handshake"===t.action&&(t.delay=0,r.reset(!1),this.resetBackoffPeriod())}n.call(be,t)},this.receive=le,He=function(e){be._debug("Received",e);for(var t=0;t<e.length;++t)le(e[t])},We=function(e,t,n){be._debug("handleFailure",e,t,n),n.transport=e;for(var r=0;r<t.length;++r){var i=t[r],s={id:i.id,successful:!1,channel:i.channel,failure:n};switch(n.message=i,i.channel){case"/meta/handshake":G(s);break;case"/meta/connect":Y(s);break;case"/meta/disconnect":te(s);break;case"/meta/subscribe":s.subscription=i.subscription,ie(s);break;case"/meta/unsubscribe":s.subscription=i.subscription,oe(s);break;default:de(s)}}},this.registerTransport=function(e,t,n){var r=xe.add(e,t,n);return r&&(this._debug("Registered transport",e),d(t.registered)&&t.registered(e,this)),r},this.unregisterTransport=function(e){var t=xe.remove(e);return null!==t&&(this._debug("Unregistered transport",e),d(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){xe.clear()},this.getTransportTypes=function(){return xe.getTransportTypes()},this.findTransport=function(e){return xe.find(e)},this.getTransportRegistry=function(){return xe},this.configure=function(e){g.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){if("disconnected"!==ke)throw"Illegal state: handshaken";F(e,t)},this.disconnect=function(e,t){if(!b()){d(e)&&(t=e,e=void 0);var n={id:T(),channel:"/meta/disconnect"},r=this._mixin(!1,{},e,n);be._putCallback(r.id,t),y("disconnecting"),D([r],!1,"disconnect")}},this.startBatch=function(){P()},this.endBatch=function(){L()},this.batch=function(e,t){var n=pe(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(e){throw this._info("Exception during execution of batch",e),this.endBatch(),e}},this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";return ge(e,t,n,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;h(e)},this.clearListeners=function(){Re={}},this.subscribe=function(e,t,n,r,i){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";if(b())throw"Illegal state: disconnected";d(t)&&(i=r,r=n,n=t,t=void 0),d(r)&&(i=r,r=void 0);var s=!fe(e),a=ge(e,t,n,!1);if(s){var o={id:T(),channel:"/meta/subscribe",subscription:e},c=this._mixin(!1,{},r,o);be._putCallback(c.id,i),j(c)}return a},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(b())throw"Illegal state: disconnected";d(t)&&(n=t,t=void 0),this.removeListener(e);var r=e.channel;if(!fe(r)){var i={id:T(),channel:"/meta/unsubscribe",subscription:r},s=this._mixin(!1,{},t,i);be._putCallback(s.id,n),j(s)}},this.resubscribe=function(e,t){if(m(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=function(){v()},this.publish=function(e,t,n,r){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(b())throw"Illegal state: disconnected";d(t)?(r=t,t={},n=void 0):d(n)&&(r=n,n=void 0);var i={id:T(),channel:e,data:t},s=this._mixin(!1,{},n,i);be._putCallback(s.id,r),j(s)},this.publishBinary=function(e,t,n,r,i){d(t)?(i=t,t=new ArrayBuffer(0),n=!0,r=void 0):d(n)?(i=n,n=!0,r=void 0):d(r)&&(i=r,r=void 0);var s={meta:r,data:t,last:n},a={ext:{binary:{}}};this.publish(e,s,a,i)},this.remoteCall=function(e,t,n,r,i){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!u(e))throw"Illegal argument type: target must be a string";if(b())throw"Illegal state: disconnected";if(d(t)?(i=t,t={},n=Be.maxNetworkDelay,r=void 0):d(n)?(i=n,n=Be.maxNetworkDelay,r=void 0):d(r)&&(i=r,r=void 0),"number"!=typeof n)throw"Illegal argument type: timeout must be a number";e.match(/^\//)||(e="/"+e);var s="/service"+e,a={id:T(),channel:s,data:t},o=this._mixin(!1,{},r,a),c={callback:i};n>0&&(c.timeout=be.setTimeout(function(){be._debug("Timing out remote call",o,"after",n,"ms"),ce({id:o.id,error:"406::timeout",successful:!1,failure:{message:o,reason:"Remote Call Timeout"}})},n),be._debug("Scheduled remote call timeout",o,"in",n,"ms")),Ee[o.id]=c,j(o)},this.remoteCallBinary=function(e,t,n,r,i,s){d(t)?(s=t,t=new ArrayBuffer(0),n=!0,r=void 0,i=Be.maxNetworkDelay):d(n)?(s=n,n=!0,r=void 0,i=Be.maxNetworkDelay):d(r)?(s=r,r=void 0,i=Be.maxNetworkDelay):d(i)&&(s=i,i=Be.maxNetworkDelay);var a={meta:r,data:t,last:n},o={ext:{binary:{}}};this.remoteCall(e,a,i,o,s)},this.getStatus=function(){return ke},this.isDisconnected=b,this.setBackoffIncrement=function(e){Be.backoffIncrement=e},this.getBackoffIncrement=function(){return Be.backoffIncrement},this.getBackoffPeriod=function(){return Oe},this.increaseBackoffPeriod=function(){return O()},this.resetBackoffPeriod=function(){R()},this.setLogLevel=function(e){Be.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: extension name must be a string";for(var n=!1,r=0;r<Ae.length;++r)if(Ae[r].name===e){n=!0;break}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(Ae.push({name:e,extension:t}),this._debug("Registered extension",e),d(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!u(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,n=0;n<Ae.length;++n){var r=Ae[n];if(r.name===e){Ae.splice(n,1),t=!0,this._debug("Unregistered extension",e);var i=r.extension;d(i.unregistered)&&i.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<Ae.length;++t){var n=Ae[t];if(n.name===e)return n.extension}return null},this.getName=function(){return Te},this.getClientId=function(){return Ce},this.getURL=function(){if(he){var e=he.getURL();if(e)return e;if(e=Be.urls[he.getType()])return e}return Be.url},this.getTransport=function(){return he},this.getConfiguration=function(){return this._mixin(!0,{},Be)},this.getAdvice=function(){return this._mixin(!0,{},Le)},this.setTimeout=function(e,t){return ye.setTimeout(function(){try{be._debug("Invoking timed function",e),e()}catch(t){be._debug("Exception invoking timed function",e,t)}},t)},this.clearTimeout=function(e){ye.clearTimeout(e)},window.WebSocket&&this.registerTransport("websocket",new c),this.registerTransport("long-polling",new a),this.registerTransport("callback-polling",new o)},d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],l=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:u,Transport:i,RequestTransport:s,LongPollingTransport:a,CallbackPollingTransport:o,WebSocketTransport:c,Utils:n,Z85:{encode:function(e){var t=null;if(e instanceof ArrayBuffer?t=e:e.buffer instanceof ArrayBuffer?t=e.buffer:Array.isArray(e)&&(t=new Uint8Array(e).buffer),null==t)throw"Cannot Z85 encode "+e;for(var n=t.byteLength,r=n%4,i=4-(0===r?4:r),s=new DataView(t),a="",o=0,c=0;c<n+i;++c){var u=c>=n;if(o=256*o+(u?0:s.getUint8(c)),(c+1)%4==0){for(var l=52200625,f=5;f>0;--f){if(!u||f>i){var p=Math.floor(o/l)%85;a+=d[p]}l/=85}o=0}}return a},decode:function(e){for(var t=e.length%5,n=5-(0===t?5:t),r=0;r<n;++r)e+=d[d.length-1];for(var i=e.length,s=new ArrayBuffer(4*i/5-n),a=new DataView(s),o=0,c=0,u=0,f=0;f<i;++f){var p=e.charCodeAt(c++)-32;if(o=85*o+l[p],c%5==0){for(var g=16777216;g>=1;)u<a.byteLength&&a.setUint8(u++,Math.floor(o/g)%256),g/=256;o=0}}return s}}}}()}()},"./webapp/lib/thirdparty/jquery.cometd.js":function(e,t,n){"use strict";var r,i,s,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(o,c){"object"===a(t)?e.exports=c(n("./node_modules/jquery/dist/jquery.js"),n("./node_modules/cometd/cometd.js")):(i=[n("./node_modules/jquery/dist/jquery.js"),n("./node_modules/cometd/cometd.js")],r=c,void 0!==(s="function"==typeof r?r.apply(t,i):r)&&(e.exports=s))}(0,function(e,t){function n(e,t){if(t)for(var n in t)if(t.hasOwnProperty(n)){if("content-type"===n.toLowerCase())continue;e.setRequestHeader(n,t[n])}}function r(){var r=new t.LongPollingTransport,i=t.Transport.derive(r);return i.xhrSend=function(t){return e.ajax({url:t.url,async:!0!==t.sync,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},i}function i(){var r=new t.CallbackPollingTransport,i=t.Transport.derive(r);return i.jsonpSend=function(t){e.ajax({url:t.url,async:!0!==t.sync,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},i}return e.CometD=function(e){var n=new t.CometD(e);return n.unregisterTransports(),window.WebSocket&&n.registerTransport("websocket",new t.WebSocketTransport),n.registerTransport("long-polling",new r),n.registerTransport("callback-polling",new i),n},e.cometd=new e.CometD,e.cometd})},"./webapp/plugins/cx-webchat-service/controllers/legacy-controller.js":function(t,n,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=r("./node_modules/jquery/dist/jquery.js"),u=i(c),d=r("./webapp/plugins/cx-common/cx-common.js"),l=i(d),f=r("./node_modules/js-cookie/src/js.cookie.js"),p=i(f);i((i(r("./node_modules/cometd/cometd.js")),r("./webapp/lib/thirdparty/jquery.cometd.js"))),CXBus.registerModule("webchatservicelegacy",function(){function t(){n.registerEvents(["ready","restored","restoreTimeout","restoreFailed","messageReceived","error","started","ended","agentTypingStarted","agentTypingStopped","pollingStarted","pollingStopped","clientConnected","clientDisconnected","agentConnected","agentDisconnected","supervisorConnected","supervisorDisconnected","botConnected","botDisconnected","clientTypingStarted","clientTypingStopped","ajaxResponse","disconnected","reconnected","chatServerWentOffline","chatServerBackOnline","sleeping","waking"]);var t=setInterval,r=!1,i=3e3,c=3e3,d=3e3,f=500,g=1.2,h=3e4,m=0,v=0,y=5,b=!1,T=!0,w=!0,x=3e3,k=0,S={withCredentials:!1},C=!1,_={sessionID:"",userId:"",secureKey:"",alias:""},I="",D="_genesys.widgets.webchat.state",j=D+".session",R=D+".keys",O=D+".ping",P=D+".filters",A=1,L=1,M=!1,E=!1,U=!1,q=!1,N=!1,F=6e4,K="",B="",H=l.default.getBrowserandOS(),W=[],J=[],z={},X={},G=!1,V=!1,$=!1,Z={enabled:!1,cometURL:"",channel:"/service/chatV2/customer-support",apiURL:"",websocketEnabled:!0,logLevel:"info"},Y=!1,Q=0,ee=!1,te=!1,ne=!1,re=!1,ie={Timer:0,Timeout:2e3,TimeInterval:100,Interval:!1,IdleCount:0,IdleLimit:2,Text:""},se={standard:[/\{start\:[0-9]{9}\}/],custom:[]},ae=[],oe=!1,ce=!1,ue=!1,de={enabled:!1,maxMessagePageSize:20},le=!1,fe=!1,pe=!1,ge=!1,he="",me=["Authorization"];n.data("sleeping",!1);var ve=function(e,t,r){if(N)return!1;var i=u.default.Deferred(),s={alias:_.alias,secureKey:_.secureKey,userId:_.userId},r=r||{};if(r=u.default.extend(s,r),V)V&&(""==e?(e="requestChat",oe=i):E&&(oe=i),Y?ye(e,t,r,i):(Fe(),l.default.watch(function(){return Y},250).done(function(){ye(e,t,r)})));else{var a=C?l.default.filterObjectProperties(n.data("App.requestHeader"),me):{};"disconnect"==e&&(ce=i),l.default.request({url:K+_.sessionID+(e?"/"+e:""),type:t,crossDomain:!0,data:r,timeout:x,cache:!1,headers:u.default.extend({},{"Content-Type":"application/x-www-form-urlencoded"},a),xhrFields:S,success:function(e){if(N)return!1;e.id&&(e.sessionId=e.id),Le(e),i.resolve(e||{}),q&&(q=!1,n.publish("reconnected")),2===e.statusCode&&e.errors&&e.errors.length>0&&n.publish("error",e),n.publishDirect("ajaxResponse",e)},error:function(t){if(N)return!1;0===t.status&&(q=!0,M?n.publish("disconnected"):n.publish("error",t));var r=t.responseJSON||{};if("refresh"==e&&r.errors&&r.errors.length>0)for(var s=0;s<r.errors.length;s++)204==r.errors[s].code&&r.errors.splice(s,1);r.errors&&r.errors.length>0&&n.publish("error",t),i.reject(t||{})},beforeSend:function(e){I&&e.setRequestHeader("apikey",I)}})}return i.promise()},ye=function(e,t,n,r){if(V&&$&&Y){"send"==e&&(e="sendMessage");var i={operation:e,chatId:_.sessionID},s=u.default.extend(i,n);$.publish(Z.channel,s),r&&r.resolve({statusCode:0})}else r&&r.reject("CometD is not configured or there is a connection issue")},be=function(t,r){var i=u.default.Deferred(),s=r.file;if(Me()){var a=new FormData,o=K+_.sessionID+(t||"");s&&a.append("file",s),V?(o=Z.apiURL,a.append("operation",t)):(a.append("alias",_.alias),a.append("userId",_.userId)),a.append("secureKey",_.secureKey),l.default.request({type:"POST",url:o,mimeType:"multipart/form-data",contentType:!1,crossDomain:!0,headers:C?l.default.filterObjectProperties(n.data("App.requestHeader"),me):{},timeout:k,processData:!1,data:a,beforeSend:function(e){I&&e.setRequestHeader("apikey",I)},success:function(e){e.id&&(e.sessionId=e.id),Le(e),i.resolve(e||{}),q&&(q=!1,n.publish("disconnected")),n.publishDirect("ajaxResponse",e)},error:function(e){if(u.default.isEmptyObject(s))n.publish("error",e);else if(400===e.status){var t=JSON.parse(e.responseText);u.default.each(t.errors,function(){this.filename=s.name}),e.responseText=JSON.stringify(t),n.publish("error",e),i.reject(e||{})}else 0===e.status&&(e.errorReason="FileUploadError",e.filename=s.name,e.file=s,n.publish("error",e));i.reject(e||{})}})}else e.deferred.reject("No HTMl5 formData support on your browser");return i.promise()},Te=function(){N=!0,n.command("stopPoll"),Ce(),Ae(),M=!1,Ge(),n.publish("ended"),n.command("App.deregisterAutoLoad")},we=function(e){var t=[];u.default.each(e.messages||[],function(){if(Ie(this.index))if("Message"!=this.type||Re(this.text)){for(var e=this,n=0;n<ae.length;n++)e=ae[n](e)||e;e=xe(this),ke(e),t.push(e),W.push(e),J.push(this)}else{var r=this;ke(r)}}),t.length>0&&(pe&&t.sort(function(e,t){return t.index-e.index}),n.publish("messageReceived",{originalMessages:e.messages,messages:t,restoring:E,sessionData:_,oldMessages:pe,idleTimeCountDown:e.idleTimerExpire})),le&&he<=1&&(ge=!0),!0===e.chatEnded&&!0===M&&Te()},xe=function(e){var t={},n=l.default.checkPath(e,"eventAttributes.structured-content.genesys-chat.content"),r=l.default.checkPath(e,"eventAttributes.GCTI_SYSTEM.party-info.style");if("string"==typeof n)try{n=JSON.parse(n)}catch(e){}if("string"==typeof r)try{r=JSON.parse(r)}catch(e){}return"TypingStarted"==e.type?t.isTyping=!0:"TypingStopped"==e.type&&(t.isTyping=!1),"FileUploaded"==e.type&&(t.fileDetails=e.userData),t.text=n&&n.text||e.text,t.type=e.type,t.index=e.index,t.timestamp=e.utcTime,t.html=e.html,t.bubble=e.bubble,t.userData=e.userData,t.from={id:e.from?parseInt(e.from.participantId):"",type:e.from?e.from.type:"",name:e.from?e.from.nickname:""},r&&"BOT"===r&&(t.from.type="Bot"),E&&(t.restoring=!0),e.index>=0&&e.index>=A&&(A=e.index+1,l.default.setCookie("_genesys.widgets.webchat.state.index",A)),t},ke=function(e){var t=e.type,r=e.from.type,i=e.from.id,s={};if("Message"!=t&&"PushUrl"!=t&&"Notice"!=t||"Agent"!=r&&"Supervisor"!=r||n.publish("agentTypingStopped"),"ParticipantJoined"==t)switch("Agent"!=r&&"Supervisor"!=r||(z[i]={name:e.from.name,connected:!0,supervisor:"Supervisor"==r,connectedTime:e.timestamp,disconnectedTime:!1}),s={message:e,agents:z,numAgentsConnected:je()},r){case"Client":n.publish("clientConnected",s);break;case"Agent":n.publish("agentConnected",s);break;case"Bot":n.publish("botConnected",s);break;case"Supervisor":n.publish("supervisorConnected",s)}else if("ParticipantLeft"==t)switch(z[i]&&(z[i].connected=!1,z[i].disconnectedTime=e.timestamp),s={message:e,agents:z,numAgentsConnected:je()},r){case"Client":n.publish("clientDisconnected",s);break;case"Agent":n.publish("agentDisconnected",s),n.publish("agentTypingStopped");break;case"Bot":n.publish("botDisconnected",s);break;case"Supervisor":n.publish("supervisorDisconnected",s),n.publish("agentTypingStopped")}"Agent"!=r&&"Supervisor"!=r||("TypingStarted"==t&&n.publish("agentTypingStarted",e),"TypingStopped"==t&&n.publish("agentTypingStopped",e))},Se=function(){return!le&&!!(T&&l.default.getCookie(O)&&(new Date).getTime()-parseInt(l.default.getCookie(O))>=F)&&(Ce(),Ae(),n.publish("restoreTimeout"),n.command("App.deregisterAutoLoad"),!0)},Ce=function(){le||(l.default.deleteCookie(j),l.default.deleteCookie(R),l.default.deleteCookie(O),l.default.deleteCookie("_genesys.widgets.webchat.state.index"))},_e=function(){Ce(),M=!1,E=!1,b=!1,T=!0,N=!1,_.sessionID="",_.userId="",_.secureKey="",_.alias="",A=1,L=1,W=[],J=[],z={},X={},v=0,Q=0,U=!1,q=!1},Ie=function(e){return!X[e]&&(X[e]=!0,!0)},De=function(e,t){"string"==typeof e&&t instanceof RegExp&&(Oe(t),n.command("sendMessage",{message:e}))},je=function(){var e=0;for(var t in z)!0===z[t].connected&&e++;return e},Re=function(e){for(var t=0;t<se.standard.length;t++)if((e+"").match(se.standard[t]))return!1;for(var n=0;n<se.custom.length;n++)if((e+"").match(se.custom[n]))return!1;return!0},Oe=function(e){if(e instanceof RegExp){e.length||(e=[e]);for(var t=0;t<e.length;t++)se.custom.filter(function(n){return String(n)===String(e[t])}).length||se.custom.push(e[t]);Pe()}},Pe=function(){for(var e,t={custom:[]},n=0;n<se.custom.length;n++)e=se.custom[n],t.custom.push({source:e.source,flags:e.flags});l.default.setCookie(P,JSON.stringify(t))},Ae=function(){se.custom=[],l.default.deleteCookie(P)},Le=function(e){if(!N){var t=_&&_.secureKey;e.chatId&&(_.sessionID=e.chatId),e.secureKey&&(_.secureKey=e.secureKey),e.alias&&(_.alias=e.alias),e.userId&&(_.userId=e.userId),le&&de.getSessionData?t!==_.secureKey&&de.getSessionData(_,p.default,l.default.getCookieOptions()):(l.default.setCookie(R,JSON.stringify({secureKey:_.secureKey,alias:_.alias,userId:_.userId})),l.default.setCookie(j,_.sessionID)),n.data("WebChatService.sessionData",_)}},Me=function(){return!!window.FormData},Ee=function(e){V&&(e=e.data,2===e.statusCode&&e.errors&&e.errors.length>0&&n.publish("error",e)),e.chatEnded||e.errors||Le(e),oe&&(oe.resolve(e),oe=!1,0!=e.statusCode&&Ge()),0==e.statusCode?(U&&(n.publish("chatServerBackOnline"),n.publish("reconnected")),ee=!1,U=!1,v=0):1==e.statusCode&&(++v>y&&(n.publish("chatServerWentOffline"),v=0),U=!0),le&&(te||fe?we(e):te=!0),le||we(e),T=!1,E=!1,pe=!1},Ue=function(e){return Le(e),!0===e.chatEnded||void 0===e.chatEnded?(Ce(),N=!0,E=!1,_.sessionID="",_.secureKey="",_.alias="",_.userId="",n.publish("restoreTimeout"),n.command("App.deregisterAutoLoad"),Ge(),!1):!1===e.chatEnded?(n.publish("restored"),we(e),E=!1,M=!0,n.command("startPoll"),le||l.default.setCookie(j,_.sessionID),1==e.statusCode&&(n.publish("restoredOffline"),U=!0),!0):void 0},qe=function(e){V&&e&&(e=e.data);var t={numAgentsConnected:0};M=!1,Ge(),Ce(),Ae(),n.publish("supervisorDisconnected",t),n.publish("agentDisconnected",t),n.publish("clientDisconnected",t),n.publish("ended"),n.command("App.deregisterAutoLoad"),$=!1,ce&&(ce.resolve(e),ce=!1)},Ne=function(){C&&$&&"function"==typeof $.configure&&$.configure({requestHeaders:l.default.filterObjectProperties(n.data("App.requestHeader"),me)})},Fe=function(){V&&($=new u.default.CometD,$.websocketEnabled=Z.websocketEnabled,$.configure({url:Z.cometURL,logLevel:Z.logLevel,requestHeaders:C?l.default.filterObjectProperties(n.data("App.requestHeader"),me):{}}),$.addListener("/meta/handshake",Be),$.addListener("/meta/connect",Ke),$.addListener("/meta/disconnect",He),$.addListener("/meta/publish",We),$.addListener(Z.channel,Ee),$.handshake())},Ke=function(e){if(Ne(),!$||$.isDisconnected())return void(Y=!1);if(Y=!0===e.successful,q&&Y){if(q=!1,!U){n.publish("reconnected");var t=le?_:l.default.getCookie(R);ve("requestNotifications","POST",{userId:t.userId,secureKey:t.secureKey,alias:t.alias,transcriptPosition:A,message:""})}}else!q&&Y?le||l.default.setCookie(O,(new Date).getTime()):q||Y||"402::Unknown client"!=e.error&&(q=!0,n.publish("disconnected"))},Be=function(e){if(!1===e.successful)oe&&5==++Q&&(Ge(),oe.reject({statusCode:1}),oe=!1,Q=0);else if(!0===e.successful){Y=!0,Q=0;var t=le?_:l.default.getCookie(R);if("string"==typeof t&&t.length>0){t=JSON.parse(t);var n=t||{},r=n.secureKey,i=n.userId,s=n.alias;r&&i&&!E&&ve("requestNotifications","POST",{userId:i,secureKey:r,alias:s,transcriptPosition:A,message:""})}}},He=function(e){$&&(Ne(),$.handshake(),n.publish("disconnected"),q=!0,U=!0,Xe())},We=function(e){},Je=function(){n.command("wake")},ze=function(){w&&(i=f)},Xe=function(){if(!ee&&M){var e=le?_:l.default.getCookie(R);ee=!0,l.default.watch(function(t,n){return ee&&ve("requestNotifications","POST",{userId:e.userId,secureKey:e.secureKey,alias:e.alias,transcriptPosition:A,message:""}),!ee},3e3,30).fail(function(){y=0,n.publish("chatServerTimeout")})}},Ge=function(){V&&$&&(Ne(),$.disconnect(),$=!1,Y=!1)},Ve=function(){E=!1,_.sessionID="",_.secureKey="",_.alias="",_.userId="",n.publish("restoreFailed")};n.registerCommand("fetchHistory",function(e){le?(pe=!0,he-=de.maxMessagePageSize,ge?(pe=!1,e.deferred.reject("No more messages to fetch")):ve("refresh","POST",{userId:_.userId,secureKey:_.secureKey,alias:_.alias,transcriptPosition:he<=0?1:he,message:""}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})):e.deferred.reject("Fetching messages history applies to only Asynchronous chat.")}),n.registerCommand("configure",function(e){if(e.data&&Object.keys(e.data).length){var t=e.data,r="string",s="number",a="boolean",m="object",v="function",b={},T={};if(o(t.apikey)!=r&&o(t.apikey)!=s||(I=t.apikey),o(t.endpoint)==r&&(B=t.endpoint),o(t.userData)==m&&u.default.extend(T,t.userData),o(t.serverURL)==r&&(K=t.serverURL),o(t.ajaxTimeout)==s&&(x=parseInt(t.ajaxTimeout)),o(t.fileUploadTimeout)==s&&(k=parseInt(t.fileUploadTimeout)),o(t.xhrFields)==m&&u.default.extend(S,t.xhrFields),"object"==o(t.cometD)&&(!0===t.cometD.enabled&&(V=!0),u.default.extend(Z,t.cometD)),o(t.dataURL)!=r||V||(K=t.dataURL.replace(/\/!*$/,""),V||(K+="/")),o(t.pollExceptionLimit)==s&&(y=parseInt(t.pollExceptionLimit)),o(t.pollIntervalIdle_ms)==s&&(d=parseInt(t.pollIntervalIdle_ms)),o(t.sleepEnabled)==a&&(ne=t.sleepEnabled),o(t.dynamicPolling)==a&&(w=t.dynamicPolling),o(t.pollRate)==s&&t.pollRate>=1e3&&t.pollRate<=3e4&&(c=parseInt(t.pollRate),i=c),o(t.pollRateMin)==s&&t.pollRateMin>=250&&t.pollRateMax<=(t.pollRateMax||c)&&(f=parseInt(t.pollRateMin)),o(t.pollRateMax)==s&&t.pollRateMax<=3e4&&t.pollRateMax>=f&&(d=parseInt(t.pollRateMax)),o(t.pollRateMult)==s&&t.pollRateMult>1&&(g=t.pollRateMult),o(t.pollRateSleep)==s&&t.pollRateSleep<=3e4&&t.pollRateSleep>=1e3&&(h=parseInt(t.pollRateSleep)),o(t.restoreTimeout)==s&&(F=parseInt(t.restoreTimeout)),o(t.maxMessageLength)==s&&(G=t.maxMessageLength),o(t.enableCustomHeader)==a&&(C=t.enableCustomHeader),o(t.async)==m&&V){if(o(t.async.enabled)==a&&(de.enabled=t.async.enabled),o(t.async.maxMessagePageSize)==s&&(de.maxMessagePageSize=t.async.maxMessagePageSize),o(t.async.setSessionData)==v){de.setSessionData=t.async.setSessionData;var _=de.setSessionData("_genesys.widgets.webchat.state.open",p.default,l.default.getCookieOptions());"undefined"!==_&&_&&"string"==typeof _&&_.length>0?b=JSON.parse(_):_&&"object"==(void 0===_?"undefined":o(_))&&Object.keys(_).length&&(b=_)}o(t.async.getSessionData)==v&&(de.getSessionData=t.async.getSessionData),le=de.enabled&&V}l.default.getCookie(j)?(le=!1,n.command("restore")):Object.keys(b).length&&(V?(le=!0,n.command("restore",{sessionData:b})):e.deferred.reject("Invalid configuration. WebChatService supports Async chat only in CometD mode.")),n.data("userData",T),e.deferred.resolve()}else e.deferred.reject("Invalid configuration")}),n.registerCommand("startChat",function(e){if(Je(),M)return e.deferred.reject("There is already an active chat session"),!1;e.data&&"boolean"==typeof e.data.async&&(le=e.data.async);var t={};if("string"==typeof e.data.userData&&""!=e.data.userData.trim()){try{t=JSON.parse(e.data.userData.trim())}catch(t){return e.deferred.reject("malformed JSON provided in userData property"),!1}"object"==(void 0===t?"undefined":o(t))&&(t=u.default.extend({},n.data("userData"),t))}else"object"==o(e.data.userData)&&(t=u.default.extend({},n.data("userData"),e.data.userData));n.data("userData",a({},n.data("userData"),t));var r={_genesys_source:l.default.isMobileDevice()?"mobile":"web",_genesys_referrer:document.referrer,_genesys_url:document.location.href,_genesys_pageTitle:document.title,_genesys_browser:H.browser,_genesys_OS:H.os,_genesys_widgets:l.default.data("version")};t=u.default.extend({GCTI_LanguageCode:ue},n.data("userData"),r),le&&(fe=!0,t=u.default.extend({GCTI_Chat_AsyncMode:"true"},t)),_e();var i={nickname:e.data.nickname||"",firstName:e.data.firstname||"",lastName:e.data.lastname||"",emailAddress:e.data.email||"",subject:e.data.subject||"",text:"",userData:t};B&&(i.endpoint=B),ve("","POST",i).done(function(t){0==t.statusCode?(M=!0,Le(t),n.publish("started",_),n.command("startPoll"),n.command("App.registerAutoLoad"),e.deferred.resolve(t)):e.deferred.reject(t)}).fail(function(t){e.deferred.reject(t)})}),n.registerCommand("getFileLimits",function(e){be(V?"fileGetLimits":"/file/limits",{}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}),n.registerCommand("endChat",function(e){if(!M)return e.deferred.reject("There is no active chat session"),!1;n.command("stopPoll"),ve("disconnect","POST",{alias:_.alias,secureKey:_.secureKey,userId:_.userId}).fail(function(t){e.deferred.reject(t)}).always(qe)}),n.registerCommand("getSessionData",function(e){e.deferred.resolve(_)}),n.registerCommand("restore",function(e){if(E)return e.deferred.reject("Already restoring. Ignoring request."),!1;if(M&&e.deferred.reject("Chat session is already active, ignoring restore command."),!le&&"WebChatService"!=e.commander)return e.deferred.reject("Access Denied to private command. Only WebChatService is allowed to invoke this command in Non-Async mode."),!1;var t,r;e.data&&e.data.async&&!0===e.data.async.enabled&&(le=!0),le?e.data&&e.data.sessionData&&(_=e.data.sessionData)&&(t=_.sessionID,r=_):(t=l.default.getCookie(j),r=l.default.getCookie(R)),"string"==typeof r&&r.length>0&&(r=JSON.parse(r)),t&&r&&Object.keys(r).length&&!Se()&&(Ce(),E=!0,_.sessionID=t,le?ve("refresh","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:Number(-1)}).done(function(t){!1===t.chatEnded&&t.messages.length>0?"number"==typeof(A=parseInt(t.messages[0].index))&&(he=parseInt(A-de.maxMessagePageSize),he=he<=0?1:he,ve("requestNotifications","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:he,message:""}).done(function(t){t&&0==t.statusCode?(E=!1,M=!0,n.publish("restored",{async:!0}),n.data("WebChatService.mode",{async:!0}),e.deferred.resolve(t)):e.deferred.reject(t)}).fail(function(t){Ve(),e.deferred.reject()})):e.deferred.reject(t)}).fail(function(t){Ve(),e.deferred.reject()}):ve(V?"requestNotifications":"refresh","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:A,message:""}).done(function(t){!0===Ue(t)?e.deferred.resolve(t):e.deferred.reject(t)}).fail(function(t){Ve(),e.deferred.reject()}))}),n.registerCommand("sendMessage",function(e){if(Je(),q)return e.deferred.resolve({statusCode:1}),!1;if(!M)return e.deferred.reject("There is no active chat session"),!1;if("string"!=typeof e.data.message||""==(e.data.message+"").trim())return e.deferred.reject("No message text provided"),!1;if(G&&[].concat(s(e.data.message)).length>G)return e.deferred.reject("Message length exceeds configured threshold of ("+G+") characters"),!1;ie.Interval&&n.publish("clientTypingStopped"),clearInterval(ie.Interval),ie.Interval=!1,ie.Timer=0,ie.text="",ie.IdleCount=0;var t={message:e.data.message,messageType:e.data.type||"text",userId:_.userId,secureKey:_.secureKey,alias:_.alias};if("number"==typeof e.data.parentMessageID||"string"==typeof e.data.parentMessageID&&e.data.parentMessageID.length>0){var r='{"general-properties": {"related-event-id":"'+e.data.parentMessageID+'"}}';t.eventAttributes=V?JSON.parse(r):r,delete e.data.parentMessageID}ve("send","POST",t).done(function(t){!0===t.chatEnded&&!0===M&&Te(),e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)}).always(function(){ze()})}),n.registerCommand("sendFile",function(e){if(Je(),!M)return e.deferred.reject("There is no active chat session"),!1;var t=!1,n=e.data.files,r=n.files[0],i=r.name,s={},a=V?"fileUpload":"/file";s.file=r,t=be(a,s),t.done(function(t){if("string"==typeof t&&(t=JSON.parse(t)),0==t.statusCode){var n=new FileReader;(0,u.default)(n).on("load",function(n){var r=n.target.result,s=[],a={from:{type:"Client"},source:r,type:"FileUploaded",timestamp:(new Date).getTime(),filename:i};s.push(a),e.deferred.resolve(t)}),n.readAsDataURL(r)}else e.deferred.reject(t)}).fail(function(t){e.deferred.reject(t)}).always(function(){ze()})}),n.registerCommand("downloadFile",function(e){var t;if(V&&Z.apiURL)t=(0,u.default)("<form method='POST' enctype='multipart/form-data' target='_blank' action="+Z.apiURL+"><input name='secureKey' value="+_.secureKey+" type='hidden'><input name='fileId' value="+e.data.fileId+" type='hidden'><input name='operation' value='fileDownload' type='hidden'></form>").appendTo(document.body);else if(V)e.deferred.reject("Could not download file. Please ensure WebChat is configured properly.");else{var n=K+_.sessionID+"/file/"+e.data.fileId+"/download";t=(0,u.default)("<form method='POST' enctype='multipart/form-data' target='_blank' action="+n+"><input name='alias' value="+_.alias+" type='hidden'><input name='secureKey' value="+_.secureKey+" type='hidden'><input name='userId' value="+_.userId+" type='hidden'></form>").appendTo(document.body)}t&&(t.submit(),e.deferred.resolve())}),n.registerCommand("sendFilteredMessage",function(e){Je(),M?(De(e.data.message,e.data.regex),e.deferred.resolve()):e.deferred.reject("No active chat session.")}),n.registerCommand("addPrefilter",function(e){if(e.data.filters&&e.data.filters instanceof RegExp)Oe(e.data.filters),e.deferred.resolve(u.default.extend({},se.custom));else if(e.data.filters.length>0&&e.data.filters[0]instanceof RegExp){for(var t=0;t<e.data.filters.length;t++)Oe(e.data.filters[t]);e.deferred.resolve(u.default.extend({},se.custom))}else e.deferred.reject("Missing or invalid filters provided. Please provide a regular expression or an array of regular expressions")}),n.registerCommand("startPoll",function(e){return V?(e.deferred.reject("Polling is not supported when using CometD"),!1):M?(!1===r&&(r=t(function(){var e=n.data("sleeping");!e&&!b&&l.default.time()-m>=i?(n.command("poll"),m=l.default.time(),w&&(i<d&&(i=parseInt(i*g)),i>d&&(i=d))):e&&!b&&l.default.time()-m>=h&&(n.command("poll"),m=l.default.time())},parseInt(f/2)),ze(),n.publish("pollingStarted")),void e.deferred.resolve()):(e.deferred.reject("There is no active chat session"),!1)}),n.registerCommand("stopPoll",function(e){if(0==r)return e.deferred.reject("Not currently polling. Ignoring command."),!1;0!=r&&(clearInterval(r),r=!1,n.publish("pollingStopped")),e.deferred.resolve()}),n.registerCommand("poll",function(e){e.commander!=n.namespace()&&e.deferred.reject("Access Denied to private command. Only WebChatService is allowed to invoke this command"),b?e.deferred.reject("previous poll has not finished"):(b=!0,le||l.default.setCookie(O,(new Date).getTime()),ve("refresh","POST",{userId:_.userId,secureKey:_.secureKey,alias:_.alias,transcriptPosition:A,message:re?re.val():""}).done(function(t){Ee(t),e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)}).always(function(){b=!1}))}),n.registerCommand("sleep",function(e){!ne||le||V||!n.data("sleeping")&&M&&(n.publish("sleeping"),n.data("sleeping",!0)),e.deferred.resolve()}),n.registerCommand("wake",function(e){var t='{"purpose":"cancel-idle-timer"}';n.data("sleeping")&&M&&(n.publish("waking"),n.data("sleeping",!1),i=c,ve("customNotice","POST",{eventAttributes:V?JSON.parse(t):t})),!0===e.data.resetIdleState&&ve("customNotice","POST",{eventAttributes:V?JSON.parse(t):t}),e.deferred.resolve()}),n.registerCommand("resetPollExceptions",function(e){U=!1,v=0,e.deferred.resolve()}),n.registerCommand("sendCustomNotice",function(e){Je(),ve("customNotice","POST",{alias:_.alias,secureKey:_.secureKey,userId:_.userId,message:e.data.message||""}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}),n.registerCommand("updateUserData",function(e){Je(),n.data("userData",a({},n.data("userData"),e.data||{})),M?ve("updateData","POST",{alias:_.alias,secureKey:_.secureKey,userId:_.userId,userData:e.data||{}}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)}):e.deferred.resolve(n.data("userData"))}),n.registerCommand("sendTyping",function(e){if(!M)return e.deferred.reject("There is no active chat session"),!1;var t=e.data||{},r=!1,i=ie,s={alias:_.alias,secureKey:_.secureKey,userId:_.userId,transcriptPosition:A};if("boolean"!=typeof t.isTyping&&(t.isTyping=!0),V)s.message=t.message||re&&re.val()||"",i.Interval||(i.Interval=setInterval(function(){re&&re.val()!=i.text?(s.message=t.message||re&&re.val()||"",r=ve("startTyping","POST",s),i.text=re.val()):++i.IdleCount==i.IdleLimit&&(clearInterval(i.Interval),i.IdleCount=0,i.Interval=!1,s.message=t.message||re&&re.val()||"",r=ve("stopTyping","POST",s))},5e3),r=ve("startTyping","POST",s));else{if(i.Interval)return i.Timer=0,e.deferred.resolve(),!1;Je(),s.message=t.message||re&&re.val()||"",r=ve("startTyping","POST",s),n.publish("clientTypingStarted"),i.Interval=setInterval(function(){i.Timer+=i.TimeInterval,i.Timer>=i.Timeout&&(s.message=t.message||re&&re.val()||"",clearInterval(i.Interval),i.Interval=!1,i.Timer=0,r=ve("stopTyping","POST",s),n.publish("clientTypingStopped"))},i.TimeInterval),r.done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}}),n.registerCommand("getAgents",function(e){e.deferred.resolve({agents:u.default.extend(z,{})})}),n.registerCommand("getTranscript",function(e){e.deferred.resolve({messages:W,originalMessages:J})}),n.registerCommand("getStats",function(e){var t={agents:u.default.extend(z,{}),startTime:!1,endTime:!1,duration:!1};W.length>0&&(t.startTime=W[0].timestamp,t.endTime=W[W.length-1].timestamp,t.duration=t.endTime-t.startTime),e.deferred.resolve(t)}),n.registerCommand("registerTypingPreviewInput",function(e){var t=(0,u.default)(e.data.input);!t||"text"!=t[0].type&&"textarea"!=t[0].type?e.deferred.reject("Invalid value provided for the 'input' property. An HTML element reference to a textarea or text input is required."):(re=t,e.deferred.resolve())}),n.registerCommand("registerPreProcessor",function(e){"function"==typeof e.data.preprocessor?(ae.push(e.data.preprocessor),e.deferred.resolve(e.data.preprocessor)):e.deferred.reject("No preprocessor function provided. Type provided was '"+o(e.data.preprocessor)+"'.")}),n.subscribe("GWE.ready",function(){n.command("GWE.getIDs").done(function(e){n.data("userData",a({},n.data("userData"),e))})}),n.subscribe("App.language",function(e){ue=e.data}),n.subscribe("App.data.pageFocus",function(e){ne&&M&&(!1===e.data.value?n.command("sleep"):!0===e.data.value&&Je())}),n.subscribe("App.data.pageHidden",function(e){ne&&M&&(!1===e.data.value&&n.data("App.pageFocus")?Je():!0===e.data.value&&n.command("sleep"))}),ne&&M&&(n.data("App.pageFocus")?Je():n.command("sleep")),function(){if(l.default.getCookie(P)){var e=JSON.parse(l.default.getCookie(P));u.default.each(e.custom,function(){se.custom.push(new RegExp(this.source,this.flags))})}}(),n.command("configure",_genesys.widgets.webchat),n.ready(),n.republish("ready")}var n="";return{init:function(e){(n=e)&&t()}}})}},["./webapp/plugins/cx-webchat-service/controllers/legacy-controller.js"]);